/* eslint-disable @typescript-eslint/no-misused-promises */ /* eslint-disable @typescript-eslint/restrict-plus-operands */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    postRouter: function() {
        return postRouter;
    },
    upload: function() {
        return upload;
    }
});
const _express = require("express");
const _multer = /*#__PURE__*/ _interop_require_default(require("multer"));
const _postcontroller = require("./post.controller");
const _passport = /*#__PURE__*/ _interop_require_default(require("passport"));
const _postschema = require("./post.schema");
const _zodvalidate = require("../middlewares/zod.validate");
const _authcontroller = require("../auth/auth.controller");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const authController = new _authcontroller.AuthController();
const postController = new _postcontroller.PostController();
const storage = _multer.default.diskStorage({
    destination: function(_req, _file, cb) {
        cb(null, './public/temp');
    },
    filename: function(_req, file, cb) {
        const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1e9);
        cb(null, file.fieldname + '-' + uniqueSuffix + '-' + file.originalname);
    }
});
const upload = (0, _multer.default)({
    storage
});
const postRouter = (0, _express.Router)();
/**
 * AUDIO ROUTES
 */ postRouter.post('/audio', upload.array('audio'), postController.uploadAudio);
postRouter.delete('/audioRemove', postController.eraseAudio);
postRouter.get('/getPostById/:id', (0, _zodvalidate.schemaValidator)(_postschema.getPostById), postController.getPostById);
/**
 * VIDEO ROUTES
 */ postRouter.post('/videoAdd', upload.single('video'), _passport.default.authenticate('jwt', {
    session: false
}), authController.jwtRenewalToken, postController.videoUpload);
postRouter.delete('/videoRm', (0, _zodvalidate.schemaValidator)(_postschema.videoEraseSchema), _passport.default.authenticate('jwt', {
    session: false
}), postController.eraseVideo);
/**
 * POST ROUTES
 */ postRouter.post('/create', upload.array('images', 5), _passport.default.authenticate('jwt', {
    session: false
}), authController.jwtRenewalToken, (0, _zodvalidate.schemaValidator)(_postschema.createPostSchema), postController.createPost);
postRouter.get('/getIds', postController.getPostsIds);
postRouter.get('/getPosts', /* schemaValidator(getPostsSchema), */ postController.getAllPosts);
postRouter.get('/get30days', postController.get30DaysPosts);
postRouter.put('/updatePost/:id', _passport.default.authenticate('jwt', {
    session: false
}), authController.jwtRenewalToken, upload.array('images', 5), postController.updatePost);
// postRouter.put('/hidePost/:id', passport.authenticate('jwt', { session: false }), authController.jwtRenewalToken, postController.hidePost)
postRouter.delete('/deletePost/:id', _passport.default.authenticate('jwt', {
    session: false
}), authController.jwtRenewalToken, (0, _zodvalidate.schemaValidator)(_postschema.getPostById), postController.deletePost);
postRouter.put('/hidePost/:id', _passport.default.authenticate('jwt', {
    session: false
}), authController.jwtRenewalToken, (0, _zodvalidate.schemaValidator)(_postschema.getPostById), postController.hidePost);
postRouter.put('/showPost/:id', _passport.default.authenticate('jwt', {
    session: false
}), authController.jwtRenewalToken, (0, _zodvalidate.schemaValidator)(_postschema.getPostById), postController.showPost);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wb3N0L3Bvc3Qucm91dGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1taXN1c2VkLXByb21pc2VzICovXHJcbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9yZXN0cmljdC1wbHVzLW9wZXJhbmRzICovXHJcbmltcG9ydCB7IFJvdXRlciwgdHlwZSBSZXF1ZXN0IH0gZnJvbSAnZXhwcmVzcydcclxuaW1wb3J0IG11bHRlciBmcm9tICdtdWx0ZXInXHJcbmltcG9ydCB7IFBvc3RDb250cm9sbGVyIH0gZnJvbSAnLi9wb3N0LmNvbnRyb2xsZXInXHJcbmltcG9ydCBwYXNzcG9ydCBmcm9tICdwYXNzcG9ydCdcclxuaW1wb3J0IHsgZ2V0UG9zdEJ5SWQsIGNyZWF0ZVBvc3RTY2hlbWEsIHZpZGVvVXBsb2FkU2NoZW1hLCB2aWRlb0VyYXNlU2NoZW1hIH0gZnJvbSAnLi9wb3N0LnNjaGVtYSdcclxuaW1wb3J0IHsgc2NoZW1hVmFsaWRhdG9yIH0gZnJvbSAnLi4vbWlkZGxld2FyZXMvem9kLnZhbGlkYXRlJ1xyXG5pbXBvcnQgeyBBdXRoQ29udHJvbGxlciB9IGZyb20gJy4uL2F1dGgvYXV0aC5jb250cm9sbGVyJ1xyXG5jb25zdCBhdXRoQ29udHJvbGxlciA9IG5ldyBBdXRoQ29udHJvbGxlcigpXHJcbmNvbnN0IHBvc3RDb250cm9sbGVyID0gbmV3IFBvc3RDb250cm9sbGVyKClcclxuY29uc3Qgc3RvcmFnZSA9IG11bHRlci5kaXNrU3RvcmFnZSh7XHJcbiAgZGVzdGluYXRpb246IGZ1bmN0aW9uIChcclxuICAgIF9yZXE6IFJlcXVlc3QsXHJcbiAgICBfZmlsZTogRXhwcmVzcy5NdWx0ZXIuRmlsZSxcclxuICAgIGNiOiAoLi4uYXJnOiBhbnkpID0+IGFueVxyXG4gICkge1xyXG4gICAgY2IobnVsbCwgJy4vcHVibGljL3RlbXAnKVxyXG4gIH0sXHJcbiAgZmlsZW5hbWU6IGZ1bmN0aW9uIChcclxuICAgIF9yZXE6IFJlcXVlc3QsXHJcbiAgICBmaWxlOiBFeHByZXNzLk11bHRlci5GaWxlLFxyXG4gICAgY2I6ICguLi5hcmdzOiBhbnkpID0+IGFueVxyXG4gICkge1xyXG4gICAgY29uc3QgdW5pcXVlU3VmZml4ID0gRGF0ZS5ub3coKSArICctJyArIE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDFlOSlcclxuICAgIGNiKG51bGwsIGZpbGUuZmllbGRuYW1lICsgJy0nICsgdW5pcXVlU3VmZml4ICsgJy0nICsgZmlsZS5vcmlnaW5hbG5hbWUpXHJcbiAgfVxyXG59KVxyXG5leHBvcnQgY29uc3QgdXBsb2FkID0gbXVsdGVyKHsgc3RvcmFnZSB9KVxyXG5leHBvcnQgY29uc3QgcG9zdFJvdXRlciA9IFJvdXRlcigpXHJcbi8qKlxyXG4gKiBBVURJTyBST1VURVNcclxuICovXHJcbnBvc3RSb3V0ZXIucG9zdCgnL2F1ZGlvJywgdXBsb2FkLmFycmF5KCdhdWRpbycpLCBwb3N0Q29udHJvbGxlci51cGxvYWRBdWRpbylcclxucG9zdFJvdXRlci5kZWxldGUoJy9hdWRpb1JlbW92ZScsIHBvc3RDb250cm9sbGVyLmVyYXNlQXVkaW8pXHJcbnBvc3RSb3V0ZXIuZ2V0KFxyXG4gICcvZ2V0UG9zdEJ5SWQvOmlkJyxcclxuICBzY2hlbWFWYWxpZGF0b3IoZ2V0UG9zdEJ5SWQpLFxyXG4gIHBvc3RDb250cm9sbGVyLmdldFBvc3RCeUlkXHJcbilcclxuLyoqXHJcbiAqIFZJREVPIFJPVVRFU1xyXG4gKi9cclxucG9zdFJvdXRlci5wb3N0KFxyXG4gICcvdmlkZW9BZGQnLFxyXG4gIHVwbG9hZC5zaW5nbGUoJ3ZpZGVvJyksXHJcbiAgcGFzc3BvcnQuYXV0aGVudGljYXRlKCdqd3QnLCB7IHNlc3Npb246IGZhbHNlIH0pLFxyXG4gIGF1dGhDb250cm9sbGVyLmp3dFJlbmV3YWxUb2tlbixcclxuXHJcbiAgcG9zdENvbnRyb2xsZXIudmlkZW9VcGxvYWQpXHJcbnBvc3RSb3V0ZXIuZGVsZXRlKCcvdmlkZW9SbScsXHJcbiAgc2NoZW1hVmFsaWRhdG9yKHZpZGVvRXJhc2VTY2hlbWEpLFxyXG4gIHBhc3Nwb3J0LmF1dGhlbnRpY2F0ZSgnand0JywgeyBzZXNzaW9uOiBmYWxzZSB9KSxcclxuICBwb3N0Q29udHJvbGxlci5lcmFzZVZpZGVvKVxyXG5cclxuLyoqXHJcbiAqIFBPU1QgUk9VVEVTXHJcbiAqL1xyXG5wb3N0Um91dGVyLnBvc3QoXHJcbiAgJy9jcmVhdGUnLFxyXG4gIHVwbG9hZC5hcnJheSgnaW1hZ2VzJywgNSksXHJcbiAgcGFzc3BvcnQuYXV0aGVudGljYXRlKCdqd3QnLCB7IHNlc3Npb246IGZhbHNlIH0pLCBhdXRoQ29udHJvbGxlci5qd3RSZW5ld2FsVG9rZW4sXHJcbiAgc2NoZW1hVmFsaWRhdG9yKGNyZWF0ZVBvc3RTY2hlbWEpLFxyXG4gIHBvc3RDb250cm9sbGVyLmNyZWF0ZVBvc3RcclxuKVxyXG5wb3N0Um91dGVyLmdldCgnL2dldElkcycsIHBvc3RDb250cm9sbGVyLmdldFBvc3RzSWRzKVxyXG5wb3N0Um91dGVyLmdldChcclxuICAnL2dldFBvc3RzJyxcclxuICAvKiBzY2hlbWFWYWxpZGF0b3IoZ2V0UG9zdHNTY2hlbWEpLCAqL1xyXG4gIHBvc3RDb250cm9sbGVyLmdldEFsbFBvc3RzXHJcbilcclxucG9zdFJvdXRlci5nZXQoJy9nZXQzMGRheXMnLCBwb3N0Q29udHJvbGxlci5nZXQzMERheXNQb3N0cylcclxucG9zdFJvdXRlci5wdXQoXHJcbiAgJy91cGRhdGVQb3N0LzppZCcsIHBhc3Nwb3J0LmF1dGhlbnRpY2F0ZSgnand0JywgeyBzZXNzaW9uOiBmYWxzZSB9KSwgYXV0aENvbnRyb2xsZXIuand0UmVuZXdhbFRva2VuLFxyXG4gIHVwbG9hZC5hcnJheSgnaW1hZ2VzJywgNSksXHJcbiAgcG9zdENvbnRyb2xsZXIudXBkYXRlUG9zdFxyXG4pXHJcbi8vIHBvc3RSb3V0ZXIucHV0KCcvaGlkZVBvc3QvOmlkJywgcGFzc3BvcnQuYXV0aGVudGljYXRlKCdqd3QnLCB7IHNlc3Npb246IGZhbHNlIH0pLCBhdXRoQ29udHJvbGxlci5qd3RSZW5ld2FsVG9rZW4sIHBvc3RDb250cm9sbGVyLmhpZGVQb3N0KVxyXG5wb3N0Um91dGVyLmRlbGV0ZSgnL2RlbGV0ZVBvc3QvOmlkJywgcGFzc3BvcnQuYXV0aGVudGljYXRlKCdqd3QnLCB7IHNlc3Npb246IGZhbHNlIH0pLCBhdXRoQ29udHJvbGxlci5qd3RSZW5ld2FsVG9rZW4sIHNjaGVtYVZhbGlkYXRvcihnZXRQb3N0QnlJZCksIHBvc3RDb250cm9sbGVyLmRlbGV0ZVBvc3QpXHJcbnBvc3RSb3V0ZXIucHV0KCcvaGlkZVBvc3QvOmlkJywgcGFzc3BvcnQuYXV0aGVudGljYXRlKCdqd3QnLCB7IHNlc3Npb246IGZhbHNlIH0pLCBhdXRoQ29udHJvbGxlci5qd3RSZW5ld2FsVG9rZW4sIHNjaGVtYVZhbGlkYXRvcihnZXRQb3N0QnlJZCksIHBvc3RDb250cm9sbGVyLmhpZGVQb3N0KVxyXG5wb3N0Um91dGVyLnB1dCgnL3Nob3dQb3N0LzppZCcsIHBhc3Nwb3J0LmF1dGhlbnRpY2F0ZSgnand0JywgeyBzZXNzaW9uOiBmYWxzZSB9KSwgYXV0aENvbnRyb2xsZXIuand0UmVuZXdhbFRva2VuLCBzY2hlbWFWYWxpZGF0b3IoZ2V0UG9zdEJ5SWQpLCBwb3N0Q29udHJvbGxlci5zaG93UG9zdClcclxuIl0sIm5hbWVzIjpbInBvc3RSb3V0ZXIiLCJ1cGxvYWQiLCJhdXRoQ29udHJvbGxlciIsIkF1dGhDb250cm9sbGVyIiwicG9zdENvbnRyb2xsZXIiLCJQb3N0Q29udHJvbGxlciIsInN0b3JhZ2UiLCJtdWx0ZXIiLCJkaXNrU3RvcmFnZSIsImRlc3RpbmF0aW9uIiwiX3JlcSIsIl9maWxlIiwiY2IiLCJmaWxlbmFtZSIsImZpbGUiLCJ1bmlxdWVTdWZmaXgiLCJEYXRlIiwibm93IiwiTWF0aCIsInJvdW5kIiwicmFuZG9tIiwiZmllbGRuYW1lIiwib3JpZ2luYWxuYW1lIiwiUm91dGVyIiwicG9zdCIsImFycmF5IiwidXBsb2FkQXVkaW8iLCJkZWxldGUiLCJlcmFzZUF1ZGlvIiwiZ2V0Iiwic2NoZW1hVmFsaWRhdG9yIiwiZ2V0UG9zdEJ5SWQiLCJzaW5nbGUiLCJwYXNzcG9ydCIsImF1dGhlbnRpY2F0ZSIsInNlc3Npb24iLCJqd3RSZW5ld2FsVG9rZW4iLCJ2aWRlb1VwbG9hZCIsInZpZGVvRXJhc2VTY2hlbWEiLCJlcmFzZVZpZGVvIiwiY3JlYXRlUG9zdFNjaGVtYSIsImNyZWF0ZVBvc3QiLCJnZXRQb3N0c0lkcyIsImdldEFsbFBvc3RzIiwiZ2V0MzBEYXlzUG9zdHMiLCJwdXQiLCJ1cGRhdGVQb3N0IiwiZGVsZXRlUG9zdCIsImhpZGVQb3N0Iiwic2hvd1Bvc3QiXSwicmFuZ2VNYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OyIsIm1hcHBpbmdzIjoiQUFBQSx5REFBeUQsR0FDekQsNERBQTREOzs7Ozs7Ozs7OztJQTRCL0NBLFVBQVU7ZUFBVkE7O0lBREFDLE1BQU07ZUFBTkE7Ozt5QkExQndCOytEQUNsQjtnQ0FDWTtpRUFDVjs0QkFDOEQ7NkJBQ25EO2dDQUNEOzs7Ozs7QUFDL0IsTUFBTUMsaUJBQWlCLElBQUlDLDhCQUFjO0FBQ3pDLE1BQU1DLGlCQUFpQixJQUFJQyw4QkFBYztBQUN6QyxNQUFNQyxVQUFVQyxlQUFNLENBQUNDLFdBQVcsQ0FBQztJQUNqQ0MsYUFBYSxTQUNYQyxJQUFhLEVBQ2JDLEtBQTBCLEVBQzFCQyxFQUF3QjtRQUV4QkEsR0FBRyxNQUFNO0lBQ1g7SUFDQUMsVUFBVSxTQUNSSCxJQUFhLEVBQ2JJLElBQXlCLEVBQ3pCRixFQUF5QjtRQUV6QixNQUFNRyxlQUFlQyxLQUFLQyxHQUFHLEtBQUssTUFBTUMsS0FBS0MsS0FBSyxDQUFDRCxLQUFLRSxNQUFNLEtBQUs7UUFDbkVSLEdBQUcsTUFBTUUsS0FBS08sU0FBUyxHQUFHLE1BQU1O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